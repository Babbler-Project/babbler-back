import User from '#models/user'
import Role from '#models/role'
import hash from '@adonisjs/core/services/hash'

export default class UserSeeder {
  public async run() {
    // Liste des utilisateurs par défaut avec leurs rôles
    const users = [
      { email: 'organisateur@example.com', password: 'password123', role: 'Organisateurs' },
      { email: 'conferencier@example.com', password: 'password123', role: 'Conférencier' },
      { email: 'utilisateur@example.com', password: 'password123', role: 'Utilisateur' }
    ]

    for (const userData of users) {
      // Vérifier si l'utilisateur existe déjà par email
      const existingUser = await User.query().where('email', userData.email).first()

      if (!existingUser) {
        // Trouver le rôle correspondant
        const role = await Role.query().where('role', userData.role).first()

        // Si le rôle existe, on crée l'utilisateur
        if (role) {
          const hashedPassword = await hash.make(userData.password) // Hasher le mot de passe

          await User.create({
            email: userData.email,
            password: hashedPassword,
            roleId: role.id
          })
        }
      }
    }
  }
}
